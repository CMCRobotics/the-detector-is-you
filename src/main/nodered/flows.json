[{"id":"81c2c71.08aaf38","type":"tab","label":"Global Flow","disabled":false,"info":""},{"id":"e0608d1f.a21fb","type":"tab","label":"Registration Flow","disabled":false,"info":""},{"id":"b6e4f42c.d53438","type":"tab","label":"Launch Flow","disabled":false,"info":""},{"id":"a8a633f5.841c3","type":"tab","label":"Vote Flow","disabled":false,"info":""},{"id":"ac2b73b1.37a75","type":"tab","label":"UI Builder test flow","disabled":false,"info":""},{"id":"561af193.0361c","type":"tab","label":"SocketIO test"},{"id":"3ba17c8f.8ee954","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"4de78a10.7d00b4","type":"ui_group","z":"","name":"Launch","tab":"3ba17c8f.8ee954","order":2,"disp":true,"width":"6","collapse":false},{"id":"f7f022.2984cfe","type":"ui_group","z":"","name":"Actions","tab":"3ba17c8f.8ee954","order":1,"disp":true,"width":"16","collapse":false},{"id":"25dc869.4d4037a","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"The Detector is You","hideToolbar":"false","allowSwipe":"false","lockMenu":"true","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":10,"cy":10,"px":5,"py":5}}},{"id":"9aaeabd4.1d2c98","type":"ui_spacer","name":"spacer","group":"f7f022.2984cfe","order":2,"width":"6","height":1},{"id":"8bce48c1.42e838","type":"ui_group","z":"","name":"Votes","tab":"3ba17c8f.8ee954","order":3,"disp":true,"width":"24","collapse":false},{"id":"ba6b4881.cb1a18","type":"mqtt-broker","z":"","name":"localhost","broker":"localhost","port":"1883","clientid":"tdiy-flow","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"2a532410.d3f95c","type":"serial-port","z":"","serialport":"/dev/ttyACM0","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"\\n","bin":"false","out":"char","addchar":"","responsetimeout":"10000"},{"id":"ee27ccfb.2952a","type":"socketio-config","z":"","port":"1881","sendClient":"true","path":"/socket.io","bindToNode":true},{"id":"31291d1e.da7372","type":"looptimer","z":"b6e4f42c.d53438","duration":"0.1","units":"Second","maxloops":"50","maxtimeout":"10","maxtimeoutunits":"Second","name":"Launch Timeout","x":440,"y":60,"wires":[["568390ea.cf4ac"],["cdb80b2.841b8f8","956b43f0.ed925"]]},{"id":"12506fc9.5a58a","type":"counter","z":"b6e4f42c.d53438","name":"countdown","init":"50","step":"-1","lower":"0","upper":null,"mode":"increment","outputs":2,"x":810,"y":60,"wires":[["cf3bf97.6505408"],[]]},{"id":"568390ea.cf4ac","type":"function","z":"b6e4f42c.d53438","name":"reset count","func":"if ( ! msg._timerpass)\n{\n    msg.reset = 50\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":60,"wires":[["12506fc9.5a58a"]]},{"id":"1948e9c9.1c4306","type":"ui_gauge","z":"b6e4f42c.d53438","name":"Countdown Gauge","group":"4de78a10.7d00b4","order":2,"width":"6","height":"6","gtype":"donut","title":"Countdown to collision","label":"","format":"{{msg.payload}}","min":0,"max":"100","colors":["#b30000","#e6e600","#3acb43"],"seg1":"33","seg2":"66","x":1510,"y":60,"wires":[]},{"id":"6f34ce51.6b0bf","type":"ui_toast","z":"b6e4f42c.d53438","position":"top right","displayTime":"3","highlight":"","sendall":true,"outputs":0,"ok":"OK","cancel":"","raw":false,"topic":"","name":"","x":950,"y":140,"wires":[]},{"id":"cdb80b2.841b8f8","type":"function","z":"b6e4f42c.d53438","name":"collision notification","func":"msg.payload = \"Collision triggered !\"\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":160,"wires":[["6f34ce51.6b0bf"]]},{"id":"cf3bf97.6505408","type":"change","z":"b6e4f42c.d53438","name":"update countdown","rules":[{"t":"set","p":"countdown","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":40,"wires":[[]]},{"id":"f1093525.3e5eb8","type":"complete","z":"b6e4f42c.d53438","name":"update countdown gauge","scope":["cf3bf97.6505408"],"uncaught":false,"x":1050,"y":80,"wires":[["453cb1ae.106fb"]]},{"id":"453cb1ae.106fb","type":"range","z":"b6e4f42c.d53438","minin":"0","maxin":"50","minout":"0","maxout":"100","action":"scale","round":true,"property":"payload","name":"scale countdown","x":1290,"y":60,"wires":[["1948e9c9.1c4306"]]},{"id":"4437b49e.ebe88c","type":"link in","z":"b6e4f42c.d53438","name":"Start Launch sequence","links":["c3a52ab8.c66a48"],"x":195,"y":180,"wires":[["31291d1e.da7372","4ea8ef5e.a69cb","43f9c786.dcce78"]]},{"id":"812ad54b.ca55e8","type":"ui_button","z":"81c2c71.08aaf38","name":"Launch","group":"f7f022.2984cfe","order":1,"width":"16","height":"2","passthru":true,"label":"Launch","tooltip":"","color":"","bgcolor":"","icon":"play_arrow","payload":"{\"particleType\":\"MUON\"}","payloadType":"json","topic":"LAUNCH","x":380,"y":60,"wires":[["c3a52ab8.c66a48"]]},{"id":"1ecab7bb.d1d698","type":"inject","z":"81c2c71.08aaf38","name":"","topic":"","payload":"launch","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":40,"wires":[["812ad54b.ca55e8"]]},{"id":"c3a52ab8.c66a48","type":"link out","z":"81c2c71.08aaf38","name":"Init Launch","links":["4437b49e.ebe88c","183dfe09.cf1842"],"x":575,"y":100,"wires":[]},{"id":"6e6cb1f2.03ef6","type":"ui_audio","z":"b6e4f42c.d53438","name":"voice collision","group":"f7f022.2984cfe","voice":"Google français","always":"","x":960,"y":220,"wires":[]},{"id":"956b43f0.ed925","type":"function","z":"b6e4f42c.d53438","name":"collision announcement","func":"msg.payload=\"Collision accomplie !\"\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":220,"wires":[["6e6cb1f2.03ef6"]]},{"id":"4ea8ef5e.a69cb","type":"function","z":"b6e4f42c.d53438","name":"collision announcement","func":"msg.payload=\"Attention ! Collision imminente !\"\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":200,"wires":[["afe98709.596d68"]]},{"id":"afe98709.596d68","type":"ui_audio","z":"b6e4f42c.d53438","name":"voice collision","group":"f7f022.2984cfe","voice":"Google français","always":"","x":720,"y":320,"wires":[]},{"id":"43f9c786.dcce78","type":"file in","z":"b6e4f42c.d53438","name":"","filename":"/data/assets/sound/hit-psyche.mp3","format":"","chunk":false,"sendError":false,"encoding":"none","x":400,"y":280,"wires":[["4729d315.80ef3c"]]},{"id":"4729d315.80ef3c","type":"ui_audio","z":"b6e4f42c.d53438","name":"","group":"f7f022.2984cfe","voice":"","always":false,"x":720,"y":420,"wires":[]},{"id":"472975a9.09435c","type":"inject","z":"a8a633f5.841c3","name":"Vote","topic":"vote","payload":"{\"class\":\"action\",\"deviceId\":\"deuv-gitd-loke-tdue\",\"team\":1,\"type\":\"vote\",\"timestamp\":1246654675475,\"choice\":1}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":90,"y":680,"wires":[["eb2b5c10.0f3da"]]},{"id":"87137099.667bf","type":"ui_gauge","z":"a8a633f5.841c3","name":"Votes Team 1 Gauge","group":"8bce48c1.42e838","order":4,"width":"2","height":"2","gtype":"gage","title":"gauge","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#b30000","#e6e600","#3acb4a"],"seg1":"","seg2":"","x":1140,"y":580,"wires":[]},{"id":"16597111.7434cf","type":"ui_gauge","z":"a8a633f5.841c3","name":"Votes Team 2 Gauge","group":"8bce48c1.42e838","order":5,"width":"2","height":"2","gtype":"gage","title":"gauge","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#b30000","#e6e600","#3acb4a"],"seg1":"","seg2":"","x":1140,"y":640,"wires":[]},{"id":"201dc824.ba6648","type":"ui_gauge","z":"a8a633f5.841c3","name":"Votes Team 3 Gauge","group":"8bce48c1.42e838","order":6,"width":"2","height":"2","gtype":"gage","title":"gauge","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#b30000","#e6e600","#3acb4a"],"seg1":"","seg2":"","x":1140,"y":700,"wires":[]},{"id":"e159871.945f378","type":"ui_gauge","z":"a8a633f5.841c3","name":"Votes Team 4 Gauge","group":"8bce48c1.42e838","order":7,"width":"2","height":"2","gtype":"gage","title":"gauge","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#b30000","#e6e600","#3acb4a"],"seg1":"","seg2":"","x":1140,"y":760,"wires":[]},{"id":"2eb3e759.33fbb8","type":"switch","z":"a8a633f5.841c3","name":"Team switch","property":"team","propertyType":"flow","rules":[{"t":"eq","v":"1","vt":"str"},{"t":"eq","v":"2","vt":"str"},{"t":"eq","v":"3","vt":"str"},{"t":"eq","v":"4","vt":"str"}],"checkall":"false","repair":false,"outputs":4,"x":690,"y":680,"wires":[[],[],[],[]]},{"id":"eb2b5c10.0f3da","type":"ui_button","z":"a8a633f5.841c3","name":"Vote","group":"8bce48c1.42e838","order":3,"width":0,"height":0,"passthru":false,"label":"Send vote","tooltip":"","color":"","bgcolor":"","icon":"","payload":"vote","payloadType":"str","topic":"","x":250,"y":680,"wires":[["a61dfe7a.dacfb"]]},{"id":"aa2b54e5.1d7338","type":"ui_slider","z":"a8a633f5.841c3","name":"Team select","label":"slider","tooltip":"","group":"8bce48c1.42e838","order":1,"width":0,"height":0,"passthru":true,"outs":"all","topic":"","min":"1","max":"4","step":1,"x":130,"y":500,"wires":[["ba41d30.620c83","c8135dc0.4ef26"]]},{"id":"ba41d30.620c83","type":"change","z":"a8a633f5.841c3","name":"","rules":[{"t":"set","p":"team","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":520,"wires":[[]]},{"id":"c8135dc0.4ef26","type":"ui_text","z":"a8a633f5.841c3","group":"8bce48c1.42e838","order":2,"width":0,"height":0,"name":"Team number","label":"Team","format":"{{msg.payload}}","layout":"col-center","x":300,"y":580,"wires":[]},{"id":"a61dfe7a.dacfb","type":"function","z":"a8a633f5.841c3","name":"Update Vote Total","func":"if (! flow.votes[msg.payload.team]){\n    flow.votes[msg.payload.team] = [0,0,0,0]\n    \n}\nflow.votes[msg.payload.team-1][msg.payload.choice] += 1;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":680,"wires":[["2eb3e759.33fbb8"]]},{"id":"cc3420c5.1d21c","type":"serial in","z":"e0608d1f.a21fb","name":"serial input","serial":"2a532410.d3f95c","x":120,"y":300,"wires":[[]]},{"id":"9de33e48.73689","type":"inject","z":"ac2b73b1.37a75","name":"","topic":"","payload":"Hello world","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":160,"wires":[["b481e255.e75b5"]]},{"id":"b481e255.e75b5","type":"uibuilder","z":"ac2b73b1.37a75","name":"","topic":"","url":"voteui","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"copyIndex":true,"showfolder":false,"x":690,"y":300,"wires":[["d07b3aa4.8b3b08"],["cd506d6.8f6209"]]},{"id":"d07b3aa4.8b3b08","type":"debug","z":"ac2b73b1.37a75","name":"data output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":950,"y":200,"wires":[]},{"id":"cd506d6.8f6209","type":"debug","z":"ac2b73b1.37a75","name":"ctrl output","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":940,"y":340,"wires":[]},{"id":"eeca48ad.ff8978","type":"debug","z":"561af193.0361c","name":"","active":true,"tosidebar":true,"console":false,"complete":"true","x":235,"y":59,"wires":[]},{"id":"98d35f30.e4e2f","type":"http in","z":"561af193.0361c","name":"","url":"/sio","method":"get","upload":false,"swaggerDoc":"","x":104,"y":317,"wires":[["942d6ae4.3b8ca8"]]},{"id":"5d9dd857.ac4be8","type":"http response","z":"561af193.0361c","name":"","x":402,"y":317,"wires":[]},{"id":"a25084ce.9a71a8","type":"socketio-in","z":"561af193.0361c","name":"","server":"ee27ccfb.2952a","rules":[{"v":"add user"},{"v":"new message"},{"v":"typing"},{"v":"stop typing"}],"x":75,"y":178,"wires":[["eeca48ad.ff8978","6586dd8c.276e54"]]},{"id":"21073fc.b890dc","type":"socketio-out","z":"561af193.0361c","name":"","server":"ee27ccfb.2952a","x":840,"y":320,"wires":[]},{"id":"6586dd8c.276e54","type":"switch","z":"561af193.0361c","name":"checkEvent","property":"socketIOEvent","propertyType":"msg","rules":[{"t":"eq","v":"new message","vt":"str"},{"t":"eq","v":"add user","vt":"str"},{"t":"eq","v":"typing","vt":"str"},{"t":"eq","v":"stop typing","vt":"str"},{"t":"eq","v":"disconnect","vt":"str"}],"checkall":"false","repair":false,"outputs":5,"x":258,"y":178,"wires":[["88eb89c2.c18778"],["8d1c8fb9.dde","ce053bcb.688978"],["e66d3525.6ec578"],["e66d3525.6ec578"],["8fa3b1a6.886a7"]]},{"id":"342f04a8.3f02fc","type":"comment","z":"561af193.0361c","name":"Switch output","info":"1 new message\n2 add user\n3 typing\n4 stop typing\n5 disconnect","x":259,"y":233,"wires":[]},{"id":"8d1c8fb9.dde","type":"function","z":"561af193.0361c","name":"add user","func":"var numUsers = flow.get ('numUsers') || 0;\n++numUsers;\nflow.set ('numUsers', numUsers);\nmsg.socketIOEvent = 'login';\nmsg.payload = {\n      numUsers: numUsers\n    };\nRED.util.setMessageProperty(msg, \"socketIOEmit\", \"emit\", true);\nreturn msg;","outputs":1,"noerr":0,"x":462,"y":135,"wires":[["21073fc.b890dc","a2de0838.38e118"]]},{"id":"a2de0838.38e118","type":"debug","z":"561af193.0361c","name":"Accept/Disconnect user","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":727,"y":134,"wires":[]},{"id":"8940614d.7ca1b","type":"debug","z":"561af193.0361c","name":"say to other","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":686,"y":168,"wires":[]},{"id":"ce053bcb.688978","type":"function","z":"561af193.0361c","name":"add user","func":"var numUsers = flow.get ('numUsers') || 0;\nmsg.socketIOEvent = 'user joined';\nRED.util.setMessageProperty(msg, \"socketIOAddStaticProperties\", {username: msg.payload}, true);\nmsg.payload = {\n      username: msg.payload,\n      numUsers: numUsers\n    };\nRED.util.setMessageProperty(msg, \"socketIOEmit\", \"broadcast.emit\", true);\nreturn msg;","outputs":1,"noerr":0,"x":462,"y":168,"wires":[["21073fc.b890dc","8940614d.7ca1b"]]},{"id":"bac2adfb.54e72","type":"debug","z":"561af193.0361c","name":"tayping","active":true,"console":"false","complete":"true","x":676,"y":201,"wires":[]},{"id":"e66d3525.6ec578","type":"function","z":"561af193.0361c","name":"typing","func":"msg.payload = {username: msg.socketIOStaticProperties.username};\nRED.util.setMessageProperty(msg, \"socketIOEmit\", \"broadcast.emit\", true);\nreturn msg;","outputs":1,"noerr":0,"x":452,"y":199,"wires":[["bac2adfb.54e72","21073fc.b890dc"]]},{"id":"8fa3b1a6.886a7","type":"function","z":"561af193.0361c","name":"disconnect","func":"var numUsers = flow.get ('numUsers') || 0;\n--numUsers;\nflow.set ('numUsers', numUsers);\nmsg.socketIOEvent = 'user left';\nmsg.payload = {\n        username: msg.socketIOStaticProperties.username,\n        numUsers: numUsers\n      };\n//RED.util.setMessageProperty(msg, \"socketIOEmit\", \"broadcast.emit\", true);\nreturn msg;","outputs":1,"noerr":0,"x":472,"y":231,"wires":[["a2de0838.38e118","21073fc.b890dc"]]},{"id":"88eb89c2.c18778","type":"function","z":"561af193.0361c","name":"new message","func":"msg.payload = {username: msg.socketIOStaticProperties.username,\n                message: msg.payload\n};\nRED.util.setMessageProperty(msg, \"socketIOEmit\", \"broadcast.emit\", true);\nreturn msg;","outputs":1,"noerr":0,"x":482,"y":102,"wires":[["21073fc.b890dc","6d214cd5.65cd14"]]},{"id":"6d214cd5.65cd14","type":"debug","z":"561af193.0361c","name":"Message","active":true,"console":"false","complete":"true","x":678,"y":101,"wires":[]},{"id":"942d6ae4.3b8ca8","type":"template","z":"561af193.0361c","name":"Chat page","field":"payload","fieldType":"msg","format":"html","syntax":"plain","template":"<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>Socket.IO Chat Example</title>\n  <style>\n\t/* Fix user-agent */\n\n* {\n  box-sizing: border-box;\n}\n\nhtml {\n  font-weight: 300;\n  -webkit-font-smoothing: antialiased;\n}\n\nhtml, input {\n  font-family:\n    \"HelveticaNeue-Light\",\n    \"Helvetica Neue Light\",\n    \"Helvetica Neue\",\n    Helvetica,\n    Arial,\n    \"Lucida Grande\",\n    sans-serif;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n  padding: 0;\n}\n\nul {\n  list-style: none;\n  word-wrap: break-word;\n}\n\n/* Pages */\n\n.pages {\n  height: 100%;\n  margin: 0;\n  padding: 0;\n  width: 100%;\n}\n\n.page {\n  height: 100%;\n  position: absolute;\n  width: 100%;\n}\n\n/* Login Page */\n\n.login.page {\n  background-color: #000;\n}\n\n.login.page .form {\n  height: 100px;\n  margin-top: -100px;\n  position: absolute;\n\n  text-align: center;\n  top: 50%;\n  width: 100%;\n}\n\n.login.page .form .usernameInput {\n  background-color: transparent;\n  border: none;\n  border-bottom: 2px solid #fff;\n  outline: none;\n  padding-bottom: 15px;\n  text-align: center;\n  width: 400px;\n}\n\n.login.page .title {\n  font-size: 200%;\n}\n\n.login.page .usernameInput {\n  font-size: 200%;\n  letter-spacing: 3px;\n}\n\n.login.page .title, .login.page .usernameInput {\n  color: #fff;\n  font-weight: 100;\n}\n\n/* Chat page */\n\n.chat.page {\n  display: none;\n}\n\n/* Font */\n\n.messages {\n  font-size: 150%;\n}\n\n.inputMessage {\n  font-size: 100%;\n}\n\n.log {\n  color: gray;\n  font-size: 70%;\n  margin: 5px;\n  text-align: center;\n}\n\n/* Messages */\n\n.chatArea {\n  height: 100%;\n  padding-bottom: 60px;\n}\n\n.messages {\n  height: 100%;\n  margin: 0;\n  overflow-y: scroll;\n  padding: 10px 20px 10px 20px;\n}\n\n.message.typing .messageBody {\n  color: gray;\n}\n\n.username {\n  font-weight: 700;\n  overflow: hidden;\n  padding-right: 15px;\n  text-align: right;\n}\n\n/* Input */\n\n.inputMessage {\n  border: 10px solid #000;\n  bottom: 0;\n  height: 60px;\n  left: 0;\n  outline: none;\n  padding-left: 10px;\n  position: absolute;\n  right: 0;\n  width: 100%;\n}  </style>\n</head>\n<body>\n  <ul class=\"pages\">\n    <li class=\"chat page\">\n      <div class=\"chatArea\">\n        <ul class=\"messages\"></ul>\n      </div>\n      <input class=\"inputMessage\" placeholder=\"Type here...\"/>\n    </li>\n    <li class=\"login page\">\n      <div class=\"form\">\n        <h3 class=\"title\">What's your nickname?</h3>\n        <input class=\"usernameInput\" type=\"text\" maxlength=\"14\" />\n      </div>\n    </li>\n  </ul>\n\n  <script src=\"https://code.jquery.com/jquery-1.10.2.min.js\"></script>\n  <script src=\"/socket.io/socket.io.js\"></script>\n  <script >$(function() {\n  var FADE_TIME = 150; // ms\n  var TYPING_TIMER_LENGTH = 400; // ms\n  var COLORS = [\n    '#e21400', '#91580f', '#f8a700', '#f78b00',\n    '#58dc00', '#287b00', '#a8f07a', '#4ae8c4',\n    '#3b88eb', '#3824aa', '#a700ff', '#d300e7'\n  ];\n\n  // Initialize variables\n  var $window = $(window);\n  var $usernameInput = $('.usernameInput'); // Input for username\n  var $messages = $('.messages'); // Messages area\n  var $inputMessage = $('.inputMessage'); // Input message input box\n\n  var $loginPage = $('.login.page'); // The login page\n  var $chatPage = $('.chat.page'); // The chatroom page\n\n  // Prompt for setting a username\n  var username;\n  var connected = false;\n  var typing = false;\n  var lastTypingTime;\n  var $currentInput = $usernameInput.focus();\n\n  var socket = io();\n\n  function addParticipantsMessage (data) {\n    var message = '';\n    if (data.numUsers === 1) {\n      message += \"there's 1 participant\";\n    } else {\n      message += \"there are \" + data.numUsers + \" participants\";\n    }\n    log(message);\n  }\n\n  // Sets the client's username\n  function setUsername () {\n    username = cleanInput($usernameInput.val().trim());\n\n    // If the username is valid\n    if (username) {\n      $loginPage.fadeOut();\n      $chatPage.show();\n      $loginPage.off('click');\n      $currentInput = $inputMessage.focus();\n\n      // Tell the server your username\n      socket.emit('add user', username);\n    }\n  }\n\n  // Sends a chat message\n  function sendMessage () {\n    var message = $inputMessage.val();\n    // Prevent markup from being injected into the message\n    message = cleanInput(message);\n    // if there is a non-empty message and a socket connection\n    if (message && connected) {\n      $inputMessage.val('');\n      addChatMessage({\n        username: username,\n        message: message\n      });\n      // tell server to execute 'new message' and send along one parameter\n      socket.emit('new message', message);\n    }\n  }\n\n  // Log a message\n  function log (message, options) {\n    var $el = $('<li>').addClass('log').text(message);\n    addMessageElement($el, options);\n  }\n\n  // Adds the visual chat message to the message list\n  function addChatMessage (data, options) {\n    // Don't fade the message in if there is an 'X was typing'\n    var $typingMessages = getTypingMessages(data);\n    options = options || {};\n    if ($typingMessages.length !== 0) {\n      options.fade = false;\n      $typingMessages.remove();\n    }\n\n    var $usernameDiv = $('<span class=\"username\"/>')\n      .text(data.username)\n      .css('color', getUsernameColor(data.username));\n    var $messageBodyDiv = $('<span class=\"messageBody\">')\n      .text(data.message);\n\n    var typingClass = data.typing ? 'typing' : '';\n    var $messageDiv = $('<li class=\"message\"/>')\n      .data('username', data.username)\n      .addClass(typingClass)\n      .append($usernameDiv, $messageBodyDiv);\n\n    addMessageElement($messageDiv, options);\n  }\n\n  // Adds the visual chat typing message\n  function addChatTyping (data) {\n    data.typing = true;\n    data.message = 'is typing';\n    addChatMessage(data);\n  }\n\n  // Removes the visual chat typing message\n  function removeChatTyping (data) {\n    getTypingMessages(data).fadeOut(function () {\n      $(this).remove();\n    });\n  }\n\n  // Adds a message element to the messages and scrolls to the bottom\n  // el - The element to add as a message\n  // options.fade - If the element should fade-in (default = true)\n  // options.prepend - If the element should prepend\n  //   all other messages (default = false)\n  function addMessageElement (el, options) {\n    var $el = $(el);\n\n    // Setup default options\n    if (!options) {\n      options = {};\n    }\n    if (typeof options.fade === 'undefined') {\n      options.fade = true;\n    }\n    if (typeof options.prepend === 'undefined') {\n      options.prepend = false;\n    }\n\n    // Apply options\n    if (options.fade) {\n      $el.hide().fadeIn(FADE_TIME);\n    }\n    if (options.prepend) {\n      $messages.prepend($el);\n    } else {\n      $messages.append($el);\n    }\n    $messages[0].scrollTop = $messages[0].scrollHeight;\n  }\n\n  // Prevents input from having injected markup\n  function cleanInput (input) {\n    return $('<div/>').text(input).text();\n  }\n\n  // Updates the typing event\n  function updateTyping () {\n    if (connected) {\n      if (!typing) {\n        typing = true;\n        socket.emit('typing');\n      }\n      lastTypingTime = (new Date()).getTime();\n\n      setTimeout(function () {\n        var typingTimer = (new Date()).getTime();\n        var timeDiff = typingTimer - lastTypingTime;\n        if (timeDiff >= TYPING_TIMER_LENGTH && typing) {\n          socket.emit('stop typing');\n          typing = false;\n        }\n      }, TYPING_TIMER_LENGTH);\n    }\n  }\n\n  // Gets the 'X is typing' messages of a user\n  function getTypingMessages (data) {\n    return $('.typing.message').filter(function (i) {\n      return $(this).data('username') === data.username;\n    });\n  }\n\n  // Gets the color of a username through our hash function\n  function getUsernameColor (username) {\n    // Compute hash code\n    var hash = 7;\n    for (var i = 0; i < username.length; i++) {\n       hash = username.charCodeAt(i) + (hash << 5) - hash;\n    }\n    // Calculate color\n    var index = Math.abs(hash % COLORS.length);\n    return COLORS[index];\n  }\n\n  // Keyboard events\n\n  $window.keydown(function (event) {\n    // Auto-focus the current input when a key is typed\n    if (!(event.ctrlKey || event.metaKey || event.altKey)) {\n      $currentInput.focus();\n    }\n    // When the client hits ENTER on their keyboard\n    if (event.which === 13) {\n      if (username) {\n        sendMessage();\n        socket.emit('stop typing');\n        typing = false;\n      } else {\n        setUsername();\n      }\n    }\n  });\n\n  $inputMessage.on('input', function() {\n    updateTyping();\n  });\n\n  // Click events\n\n  // Focus input when clicking anywhere on login page\n  $loginPage.click(function () {\n    $currentInput.focus();\n  });\n\n  // Focus input when clicking on the message input's border\n  $inputMessage.click(function () {\n    $inputMessage.focus();\n  });\n\n  // Socket events\n\n  // Whenever the server emits 'login', log the login message\n  socket.on('login', function (data) {\n    connected = true;\n    // Display the welcome message\n    var message = \"Welcome to Socket.IO Chat � \";\n    log(message, {\n      prepend: true\n    });\n    addParticipantsMessage(data);\n  });\n\n  // Whenever the server emits 'new message', update the chat body\n  socket.on('new message', function (data) {\n    addChatMessage(data);\n  });\n\n  // Whenever the server emits 'user joined', log it in the chat body\n  socket.on('user joined', function (data) {\n    log(data.username + ' joined');\n    addParticipantsMessage(data);\n  });\n\n  // Whenever the server emits 'user left', log it in the chat body\n  socket.on('user left', function (data) {\n    log(data.username + ' left');\n    addParticipantsMessage(data);\n    removeChatTyping(data);\n  });\n\n  // Whenever the server emits 'typing', show the typing message\n  socket.on('typing', function (data) {\n    addChatTyping(data);\n  });\n\n  // Whenever the server emits 'stop typing', kill the typing message\n  socket.on('stop typing', function (data) {\n    removeChatTyping(data);\n  });\n\n  socket.on('disconnect', function () {\n    log('you have been disconnected');\n  });\n\n  socket.on('reconnect', function () {\n    log('you have been reconnected');\n    if (username) {\n      socket.emit('add user', username);\n    }\n  });\n\n  socket.on('reconnect_error', function () {\n    log('attempt to reconnect has failed');\n  });\n\n});\n</script>\n</body>\n</html>\n","x":258,"y":317,"wires":[["5d9dd857.ac4be8"]]}]